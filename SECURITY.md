# セキュリティガイドライン

## 🔐 認証システムセキュリティ

### 環境変数の設定

本番環境では以下の環境変数を必ず設定してください：

```bash
# 32文字以上の強力なシークレットキー
JWT_SECRET=your-cryptographically-secure-jwt-secret-32-chars-min
JWT_REFRESH_SECRET=your-cryptographically-secure-refresh-secret-32-chars-min

# JWT設定
JWT_ISSUER=your-domain.com
JWT_AUDIENCE=your-domain.com

# HTTPS必須
HTTPS=true
```

### セキュリティチェックリスト

#### 本番環境デプロイ前
- [ ] JWT_SECRET/JWT_REFRESH_SECRETをランダム生成された強力な値に変更
- [ ] HTTPS有効化
- [ ] セキュリティヘッダー設定
- [ ] レート制限実装
- [ ] データベース移行（インメモリセッション廃止）

#### 定期的な監査項目
- [ ] 秘密鍵の定期的なローテーション（3-6ヶ月）
- [ ] 依存関係の脆弱性スキャン
- [ ] アクセスログの監視
- [ ] 異常な認証試行の検知

### 既知の制限事項

#### 現在の実装での制約
1. **インメモリセッション管理**: サーバー再起動で無効化されたセッションが復活
   - 本番では Redis/Database への移行が必要

2. **モックユーザーデータ**: 固定テストデータが含まれている
   - 本番前に実際のユーザー管理システムに置き換え必要

3. **セッション無効化**: 現在はローカルブラックリストのみ
   - 分散環境での共有ストレージが必要

### セキュリティベストプラクティス

#### JWT設定
- **アルゴリズム**: HS256固定（アルゴリズム攻撃対策済み）
- **有効期限**: アクセストークン15分、リフレッシュトークン7日
- **Issuer/Audience**: 検証済み

#### Cookie設定
- **HTTPOnly**: XSS攻撃対策
- **Secure**: HTTPS必須（本番環境）
- **SameSite=Strict**: CSRF攻撃対策
- **Path=/**: 全サイト適用

#### CSRF対策
- **Double Submit Cookie**: 実装済み
- **強力なトークン生成**: 暗号学的に安全な乱数使用

### 脆弱性報告

セキュリティに関する問題を発見した場合は、以下の手順で報告してください：

1. **プライベート報告**: 公開リポジトリではなく、直接開発チームに連絡
2. **詳細情報**: 再現手順、影響範囲、推奨修正方法を含める
3. **緊急度**: 重要度に応じて緊急度を明記

### 更新履歴

- 2024-06-23: 初版作成
- セッション管理基盤実装
- セキュリティレビュー完了